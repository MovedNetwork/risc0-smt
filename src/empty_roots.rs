use risc0_zkvm::sha::Digest;

/// Contains precomputed roots of empty subtrees in a Merkle tree.
pub struct EmptySubtreeRoots;

impl EmptySubtreeRoots {
    /// Returns the node's digest for a sub-tree with all its leaves set to the empty digest.
    pub const fn entry(tree_depth: u8, node_depth: u8) -> &'static Digest {
        assert!(node_depth <= tree_depth);
        let pos = tree_depth - node_depth;
        &EMPTY_SUBTREES[pos as usize]
    }
}

const EMPTY_SUBTREES: [Digest; 65] = [
    Digest::new([0, 0, 0, 0, 0, 0, 0, 0]),
    Digest::new([
        3197654746, 1773451543, 2572628834, 3401490295, 2446648716, 1130549952, 3942252218,
        3634968344,
    ]),
    Digest::new([
        2876208860, 1036987465, 4090775838, 1596175732, 2852545957, 961356482, 3573302265,
        1284965010,
    ]),
    Digest::new([
        1631586879, 1750667393, 115584765, 1009247097, 4180391782, 3151951271, 2728441331,
        2459907438,
    ]),
    Digest::new([
        637906982, 4249025684, 4226192383, 2362667354, 1541199677, 3943749482, 40274948, 2877231923,
    ]),
    Digest::new([
        3236694273, 4284032626, 2399880579, 3863382139, 4082706555, 3084464188, 968873388,
        827254218,
    ]),
    Digest::new([
        2359005247, 3640645603, 134853541, 1000343030, 1766963213, 500993365, 3384589223, 634625968,
    ]),
    Digest::new([
        2786018880, 103442876, 2787210740, 2085902962, 610961922, 4043932685, 3040667237,
        1070768717,
    ]),
    Digest::new([
        1951795340, 3661863716, 2687605275, 518529256, 2151871349, 3115713403, 562252262,
        2394145403,
    ]),
    Digest::new([
        205882272, 2812518939, 3657070270, 2076392401, 3179528164, 939284798, 1656370778,
        2550293212,
    ]),
    Digest::new([
        3168460061, 3912084012, 2363619823, 1077500556, 3895884141, 3474373769, 4114919851,
        2183529152,
    ]),
    Digest::new([
        193932738, 3847635038, 582621427, 2109742089, 3192875445, 4034848949, 2093343447,
        2654294691,
    ]),
    Digest::new([
        2922685577, 1758980895, 569036414, 2720038864, 3494454353, 3857638028, 3117248856,
        856845524,
    ]),
    Digest::new([
        4292555635, 2465206717, 984851015, 3301195265, 3626573876, 2754339409, 407295109, 353122129,
    ]),
    Digest::new([
        1250209117, 1886078649, 1897088503, 455264917, 2873553736, 1593525713, 3030918140,
        578834618,
    ]),
    Digest::new([
        2920119888, 3841706881, 238550359, 21154545, 272676546, 1152114051, 2365803022, 3294159809,
    ]),
    Digest::new([
        699649469, 2160691249, 1736605821, 3481568769, 3279610092, 264258138, 11827500, 1563436344,
    ]),
    Digest::new([
        159430074, 745316722, 1712083746, 1477078278, 3196578151, 1517099730, 1013451589, 165138417,
    ]),
    Digest::new([
        1242278417, 2954075090, 420914007, 1661817046, 3442857836, 511802832, 1273783714,
        1490074571,
    ]),
    Digest::new([
        2964407633, 48218709, 3816117945, 3734076281, 627934235, 2148154368, 126879805, 1791881768,
    ]),
    Digest::new([
        2247238403, 1329918731, 157043787, 3346924966, 4103115030, 1184811866, 3753069208,
        1794163918,
    ]),
    Digest::new([
        3796243815, 2946571627, 3794879861, 1365936749, 3713481223, 1925459415, 3409949935,
        4294933541,
    ]),
    Digest::new([
        3148424123, 2095410597, 3534783666, 744758448, 1436196087, 2047275107, 304359713,
        2329369364,
    ]),
    Digest::new([
        919080179, 1310455737, 734520190, 643027487, 2124609930, 2727441053, 461505085, 385735969,
    ]),
    Digest::new([
        1031119448, 3456360877, 195415499, 835632990, 3577818593, 2513182084, 1031475042,
        2713297232,
    ]),
    Digest::new([
        1198349970, 814570826, 2694705668, 181631197, 3880551139, 877264541, 988555707, 567669754,
    ]),
    Digest::new([
        1635381768, 3720091270, 3351883086, 2435188393, 2957220773, 589180030, 415045503,
        4272477852,
    ]),
    Digest::new([
        3677498313, 724497474, 4187858416, 3336919813, 757388137, 1700221940, 749630875, 1349494567,
    ]),
    Digest::new([
        1948965824, 3947924633, 1330882171, 4228792685, 2294006823, 740470956, 686425721, 297084835,
    ]),
    Digest::new([
        3356673751, 2435938583, 1384572577, 3598063634, 266649011, 3274417487, 3864794132,
        1506987493,
    ]),
    Digest::new([
        275784626, 1923180396, 185857545, 1567858624, 70036099, 786911228, 554424485, 3471254375,
    ]),
    Digest::new([
        4141180831, 2420926052, 3824042009, 3017092560, 2066659812, 1108116034, 3914945020,
        706167067,
    ]),
    Digest::new([
        332224684, 2428698248, 2498861267, 1229215307, 1484864678, 3513472640, 2214037969,
        2349611934,
    ]),
    Digest::new([
        3890911318, 3495842248, 2603839578, 672169183, 332049639, 3650615972, 2885783379,
        3818555533,
    ]),
    Digest::new([
        2006272301, 2482730506, 1269255217, 501883957, 3498731701, 3934478759, 2403999767,
        1000294914,
    ]),
    Digest::new([
        3247606110, 1858171568, 1403529374, 3059743576, 1484855952, 3688523383, 1941545082,
        1693635294,
    ]),
    Digest::new([
        515333609, 3130094111, 457611604, 1042290119, 4199266345, 3152249666, 352995199, 1314447824,
    ]),
    Digest::new([
        3178819649, 2764579864, 4083423671, 1348053652, 401332356, 808876729, 234306115, 4142915600,
    ]),
    Digest::new([
        3862925729, 825360818, 2067503, 3963410141, 4059366266, 2452936919, 189540602, 2954912605,
    ]),
    Digest::new([
        3292566714, 1559624923, 1532649707, 301764745, 2267213816, 3776089357, 1233582384,
        3011816990,
    ]),
    Digest::new([
        1580063561, 1543616546, 3608168622, 1275155550, 663120212, 3965837624, 555805846,
        2323781767,
    ]),
    Digest::new([
        3089073620, 3151961667, 2911182475, 1733921190, 2110315202, 714687731, 3975281157,
        3387832056,
    ]),
    Digest::new([
        1151314916, 3507286128, 1971115158, 3665440456, 2128703472, 1396256260, 3585424345,
        4225272941,
    ]),
    Digest::new([
        1126187902, 3018606920, 2863657303, 1151672762, 288222976, 2470181071, 2952628093,
        2575409060,
    ]),
    Digest::new([
        2564557314, 3170594009, 989599178, 3982505888, 3280365096, 3348258139, 2578015435,
        1420334259,
    ]),
    Digest::new([
        2679252538, 3606949089, 3159466438, 2513165251, 800984737, 133714693, 1738233465,
        2001609911,
    ]),
    Digest::new([
        2248748524, 4108165350, 3568473912, 883964914, 3774822645, 284370696, 4083370460,
        4211834662,
    ]),
    Digest::new([
        4168319188, 4035026817, 3275722293, 3346793562, 481198656, 4213370551, 1677827168,
        3872408211,
    ]),
    Digest::new([
        1614250157, 1928434455, 13311556, 2676823004, 628200901, 3967992812, 2171593573, 4221159293,
    ]),
    Digest::new([
        1409962186, 1299182401, 3101062134, 912066541, 3871859418, 3341292616, 3077986826,
        3904683689,
    ]),
    Digest::new([
        3714919234, 3694211655, 2449364557, 3586933812, 4150361199, 3394746951, 4016008596,
        2688604274,
    ]),
    Digest::new([
        3975430571, 2517161911, 420380693, 2201732604, 3993365881, 1730529333, 4253242633,
        892403600,
    ]),
    Digest::new([
        2187458491, 3947640136, 2650587419, 650396348, 3770802852, 1757758420, 3327562298,
        1875037486,
    ]),
    Digest::new([
        350685925, 3314482297, 321526121, 436284935, 1201612028, 9826330, 1576483306, 3210147850,
    ]),
    Digest::new([
        2450214119, 2994541600, 1480264405, 1568084948, 1770309910, 265938699, 2570961931,
        2310447579,
    ]),
    Digest::new([
        172634665, 1461113160, 2342525861, 3212396544, 443205327, 1843625163, 646793214, 1212893269,
    ]),
    Digest::new([
        1026463112, 2976694282, 22177387, 1699291666, 1580343962, 4101031937, 1809459614,
        2195740439,
    ]),
    Digest::new([
        4068079821, 2945801027, 4147849732, 2180468920, 97011346, 3590543400, 4076141439, 80789141,
    ]),
    Digest::new([
        618857952, 1112476448, 867984012, 3281380913, 3497812083, 58305018, 2705062465, 3314229997,
    ]),
    Digest::new([
        1917273141, 1034267002, 1801139416, 1127508332, 2935254757, 281285562, 1489542935,
        3576919966,
    ]),
    Digest::new([
        2849854170, 3240699935, 3528986204, 188126618, 3476073350, 25275404, 4079561347, 4052038028,
    ]),
    Digest::new([
        343464647, 350300386, 2346127684, 4271005779, 4241296274, 2649844931, 2063882514,
        3042475302,
    ]),
    Digest::new([
        2348196267, 3058510700, 883361484, 1009848846, 2790148683, 3950883294, 3446021694,
        737389710,
    ]),
    Digest::new([
        1336828097, 1299622756, 2907851398, 1813132126, 98655307, 3723394468, 426818677, 4014428826,
    ]),
    Digest::new([
        4230209514, 3709130137, 3523519118, 2844649763, 2602533768, 658512221, 3072369996,
        2319259643,
    ]),
];

#[cfg(test)]
mod tests {
    use {super::*, risc0_zkvm::sha::Sha256};

    #[test]
    fn test_empty_subtrees() {
        let mut state = Digest::new([0; 8]);
        let iter = core::iter::from_fn(|| {
            let result = Some(state);
            state = *risc0_zkvm::sha::Impl::hash_pair(&state, &state);
            result
        });
        for (actual, expected) in EMPTY_SUBTREES.into_iter().zip(iter) {
            assert_eq!(actual, expected, "{:?}", expected.as_words());
        }
    }
}
